<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointment</title>
    
</head>
<body>
    <div class="head1">
        <h1>Appointment</h1>
    </div>
    <hr>
   <div class="contaner">
 <form  onsubmit="submitItem()" >
        <label for="item">Name</label>
         <input type="name" id="name" class="naame">
         <label for="product">E-mail</label>
         <input type="email" class="email" id="email" value="@gmail.com" >
         <label for="phone"></label>
         <input type="number" id="phone" class="phone">      

    <input type="submit" class="submit" id="submit" value="submit">
       
</form>
<br>
<hr>
<div id="show">
</div>

</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.min.js"></script>
 <script>
  const addItem=document.getElementById('show')
function shawitem(){
  try{
 axios.get(`http://localhost:3000/user/get`).then(e=> e.data.forEach(e =>showScreen(e,2)))
  }
  catch(er){  console.log('error while loading screen',er)  }
}
shawitem()//print when screen load .....or can use dom loded 

document.getElementById('submit').addEventListener('click', async(e)=>{
  try{
    e.preventDefault()
     let obj={
    name : document.getElementById('name').value,
    email : document.getElementById('email').value,
    phone: document.getElementById('phone').value
}
showScreen(obj,0)
  } catch(e){  console.log('error while entring data',e)   }
})
async function showScreen(obj,val){
  try{
          let li=document.createElement('li')
            li.appendChild(document.createTextNode(`${obj.name} : ${obj.email} : ${obj.phone}`))
              let butt=document.createElement('button')
            butt.appendChild(document.createTextNode('Delete'))
            butt.className='delete' 
            let edit=document.createElement('button')
            edit.appendChild(document.createTextNode('Edit'))
            edit.className='edit'     
            li.appendChild(butt)
            li.appendChild(edit)
            addItem.appendChild(li)
          
            if(val===0){
          await axios.post(`http://localhost:3000/user/post`,obj).then(e=>{
          let l=e.data.id
          butt.value=l
          edit.value=l
         })
        }
        else{
          butt.value=obj.id
          edit.value=obj.id
        }
   }catch(e){   console.log('error while screen showing',e)   }
}

addItem.addEventListener('click',(e)=>{
  try{
         let ed= e.target.classList.contains('edit');
        if(e.target.classList.contains('delete') || ed){
          let ur=e.target.value
          let li=e.target.parentElement
          addItem.removeChild(li)
          if(!ed){
            axios.post(`http://localhost:3000/delete/${ur}`).then(e=>console.log(e)).catch(e=>console.log(e)) //for deleting item
          }else
          {
            axios.post(`http://localhost:3000/edit/${ur}`).then(e=>{  //editing item and poping to for editing
              const v=e.data[0]
              document.getElementById('name').value=v.name
              document.getElementById('email').value=v.email
              document.getElementById('phone').value=v.phone
            }).catch(e=>console.log(e))
          }
        }
  }
  catch(e){console.log('error while adding skin item',e)}
})


    </script>
</body>
</html>
   
